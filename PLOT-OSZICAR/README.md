# VASP结构优化能量分析工具

本文件夹包含用于分析VASP结构优化过程中能量变化的Python脚本。

## 文件列表

- `OSZICAR`: VASP计算生成的能量输出文件
- `plot_oszicar.py`: 基础版能量变化绘图脚本
- `plot_oszicar-2.py`: 增强版VASP能量分析工具
- `check_data.py`: 数据分布检查脚本
- `energy_convergence.png`: 生成的能量收敛图表（对数坐标）
- `energy_convergence.csv`: 生成的数据文件

## 脚本说明

### 1. plot_oszicar.py (基础版)

**功能**: 绘制OSZICAR文件中总能量E和能量变化dE的点图

**特点**:
- 简单易用，直接运行即可生成图表
- 自动提取OSZICAR文件中的E和dE数据
- 总能量E和能量变化dE分别绘制在两张子图中
- 纵坐标始终以指数形式（科学计数法）显示

**使用方法**:
```bash
python plot_oszicar.py
```

**输出**: `energy_optimization.png`

### 2. plot_oszicar-2.py (增强版)

**功能**: 高级VASP能量收敛分析工具

**特点**:
- 自动解析OSZICAR文件，支持多种电子步算法（DAV、RMM、EDIAG、CG）
- 交互式选择纵坐标类型（线性/对数）
- 支持跳过前几个点，优化图表显示
- 清晰标记离子步边界
- 能量变化dE始终以对数坐标显示，适合展示大范围数值变化
- 包含收敛阈值线（1 meV、0.1 meV、0.01 meV、0.001 meV）
- 生成高质量PNG图像（300 dpi）
- 保存完整数据到CSV文件

**使用方法**:
```bash
python plot_oszicar-2.py
```

**交互式选项**:
1. 选择纵坐标类型：
   - 1: 线性坐标
   - 2: 对数坐标（推荐初始能量很大时使用）

2. 选择跳点数：
   - 输入0到N之间的数字，跳过每个离子步前N个点

**输出**:
- `energy_convergence.png`: 能量收敛图表
- `energy_convergence.csv`: 能量数据CSV文件

### 3. check_data.py (数据检查)

**功能**: 检查OSZICAR文件中的数据分布

**特点**:
- 统计能量数据的范围和分布
- 显示dE的前5个和后5个值
- 帮助理解数据的数值范围

**使用方法**:
```bash
python check_data.py
```

## 图表说明

### 能量收敛图（plot_oszicar-2.py生成）

**上图**: 总能量E随迭代步骤的变化
- 线性坐标：适合能量变化范围较小的情况
- 对数坐标：适合初始能量很大，需要显示大幅变化的情况
- 红色虚线标记离子步边界
- 黄色标签显示离子步编号

**下图**: 能量变化dE随迭代步骤的变化
- 始终使用对数坐标，适合显示从10^1到10^-9的大范围数值
- 包含4条收敛阈值线，帮助判断收敛情况
- 蓝色曲线表示|dE|的变化趋势

## 数据格式说明

### OSZICAR文件格式

OSZICAR文件包含VASP计算过程中的能量信息，典型格式如下：
```
DAV:   1     0.826697462774E+02    0.82670E+02   -0.82168E+03   582   0.844E+02
DAV:   2     0.510555579594E+00   -0.82159E+02   -0.79173E+02   588   0.203E+02
DAV:   3    -0.631150527015E+01   -0.68221E+01   -0.67465E+01   720   0.601E+01
```

**各列含义**:
- 第1列：电子步算法（DAV、RMM等）和步数
- 第2列：总能量E（eV）
- 第3列：能量变化dE（eV）
- 后续列：其他计算参数

### CSV输出格式

生成的CSV文件包含以下列：
- 离子步：当前离子步编号
- 电子步：当前离子步内的电子步编号
- X位置：累计电子步数
- 能量_E(eV)：总能量值
- 能量变化_dE(eV)：能量变化值

## 系统要求

- Python 3.6+
- numpy
- matplotlib

## 安装依赖

```bash
pip install numpy matplotlib
```

## 使用建议

1. 对于初始能量很大的优化过程，建议使用对数坐标
2. 如果初始几个点影响整体趋势，可以适当跳过前几个点
3. 能量变化dE的对数坐标图可以清晰显示收敛过程
4. 收敛阈值线可以帮助判断优化是否达到目标精度
5. 生成的CSV文件可以用于进一步的数据处理和分析

## 示例应用

- 分析VASP结构优化过程中的能量收敛情况
- 比较不同优化算法的收敛效率
- 检查优化过程中是否出现异常能量波动
- 生成论文或报告所需的能量变化图表

## 版本历史

- v1.0: 基础版绘图功能
- v2.0: 增强版，支持交互式选项、对数坐标、离子步标记等高级功能

## 注意事项

1. 确保OSZICAR文件与脚本在同一目录下
2. 对于非常大的OSZICAR文件，解析可能需要一定时间
3. 对数坐标下，负值会被转换为绝对值显示
4. 如果出现字体显示问题，脚本会自动调整为英文字体

## 联系方式

如有问题或建议，请联系脚本作者。